---
layout: post
title: A hyper update
date: '2017-01-20T12:00:03-05:00'
tags:
- programming
- hyper
- http
- rust
- rust-lang
- mozilla
- planet
tumblr_url: https://seanmonstar.com/post/156128815358/a-hyper-update
---
<h3>hyper 0.10</h3>

<p>A new version of <a href="https://hyper.rs">hyper</a> was released last week, <a href="https://github.com/hyperium/hyper/releases/tag/v0.10.0">v0.10.0</a>, to fix a lot of dependency-related problems that the 0.9 versions were having. The biggest problem was version incompatibilities with OpenSSL. You can read <a href="https://github.com/hyperium/hyper/issues/985">all about the problem and solution in the issue tracker</a>, but the <strong>tl;dr</strong> is that hyper 0.10 no longer depends on OpenSSL, or any TLS implementation really. TLS is a big part of HTTP, but there are also several different implementations, and they all release on their own schedules. Even just an optional dependency on OpenSSL could cause unrecoverable dependency conflicts.</p>

<p>This should be the last feature release of hyper using <strong>blocking IO</strong>. You can sort of think of it as an LTS version. If there are serious bugs or security fixes, a point release will be made. But all development is completely focused on the new release that will be using tokio. Speaking of&hellip;</p>

<h3>hyper and tokio</h3>

<p>The work to make hyper use <strong>non-blocking IO</strong> has been a long road. In recent months, it has been with the help of the tokio library, which just <a href="https://tokio.rs/blog/tokio-0-1/">recently released a version</a>. We just merged the tokio branch into master this week!</p>

<blockquote>
  <p><code>wrk -t 10 -d 10s -c 20</code>: 225759.00 requests per second<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
</blockquote>

<p>The full pipeline works great, and it’s fast!<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> Using futures feels very natural when programming with the asynchronicity of HTTP messages. Instead of including inline code examples here that may grow stale, I’ll just point to the <a href="https://github.com/hyperium/hyper/tree/master/examples">examples in the hyper repository</a>. And yes, full guides will be coming soon, as part of the 0.11 release.</p>

<p>There’s still things to touch up. We’re still trying to find the best ways to a) setup an HTTP server or client for easy use, b) plug in an HTTP server or client into a the wider tokio ecosystem. There’s still internal performance things we could do to get even faster. But there’s a light at the end of this tunnel. It’s growing. If you’d like, <a href="https://github.com/hyperium/hyper/milestone/3">join in!</a> Or try to port your framework to use it, and provide feedback.</p>

<p>Soon, we’ll have a much better answer for <a href="http://arewewebyet.org">are we web yet?</a></p>

<div class="footnotes" role="doc-endnotes">
<hr>
<ol>

<li id="fn:1" role="doc-endnote">
<p>The benchmarks are hand-wavey at the moment. I surprisingly don’t have an environment available to me to benchmark a bunch of different settings and against other HTTP libraries. If you’d like to help record some benchmarks, I’d greatly appreciate it. <a href="#fnref:1" class="footnote-backref" role="doc-backlink">↩︎</a></p>
</li>

<li id="fn:2" role="doc-endnote">
<p>Of course, the biggest benefit of non-blocking IO is that it is the best way to scale when you have other IO to do in order to serve a request (files, databases, other networking, etc), or when the payloads are bigger than the the network packet size, and you want to serve thousands of those requests at the same time. <a href="#fnref:2" class="footnote-backref" role="doc-backlink">↩︎</a></p>
</li>

</ol>
</div>
