---
layout: post
title: 'This Month in hyper: August 2022'
date: '2022-08-31T13:34:34-04:00'
tags:
- rust
- rust-lang
- hyper
- tower
- monthly
- http
- http3
tumblr_url: https://seanmonstar.com/post/694122996505493504/this-month-in-hyper-august-2022
---
<p>Another hot summer month has gone by. Besides many of us convening for RustConf, a lot of wonderful contributors made great progress around <a href="https://hyper.rs">hyper</a>.</p>

<h3>10,000 stars!</h3>

<p>At the beginning of the month, we celebrated <a href="https://seanmonstar.com/2023/2022-08-02-hyper-10000-stars/">hyper reaching 10,000 stars</a> on GitHub! ‚≠ê</p>

<h3>Releases</h3>

<h4>h2 v0.3.14</h4>

<p>We released v0.3.14 of <code>h2</code>, the HTTP/2 dependency of hyper. Besides some internal refactoring, the user facing fix is that a server which responds early and wants to ignore the body will now send a <code>NO_ERROR</code> instead of a <code>CANCEL</code>, as the spec recommends, thanks to @erebe!</p>

<h4>httparse v1.8.0</h4>

<p>A new version of the HTTP/1 parser of hyper came out as well. @nox added an option to ignore invalid header lines, as browsers frequently do. And work from @lucacasonato and @AaronO improved request parsing performance by about ~13%!</p>

<h3>hyper 1.0</h3>

<p>We cruised on forward towards the stable hyper 1.0. Part of that is pushing the less stable (higher-level, more opinionated) features to <code>hyper-util</code>. So, I removed <code>hyper::client::service</code>, <code>hyper::client::connect</code>, <code>hyper::Client</code>, and <code>hyper::Server</code>. @MrGunflame removed the <code>tcp</code> feature, and it&rsquo;s related code <code>connect</code> and <code>accept</code> code.</p>

<p>The <code>body</code> module is also getting some cleaning. @Michael-J-Ward renamed <code>hyper::Body</code> to <code>hyper::body::Recv</code> temporarily (want to <a href="https://github.com/hyperium/hyper/issues/2971">bikeshed the new name</a>?), so that @RajivTS could rename <code>hyper::body::HttpBody</code> to simpler <code>hyper::body::Body</code>. @Xuanwo removed the &ldquo;full&rdquo; constructors from <code>Body</code>, and @oddgrd made <code>Body::channel</code> private, since those are now separate types in <code>http-body-util</code>. I wrote a proposal for a <a href="https://github.com/hyperium/hyper/issues/2840">forwards-compatible <code>Body</code> trait</a>, and published an article as a preface to the <a href="https://seanmonstar.com/2023/2022-08-25-pattern-matching-and-backwards-compatibility/">pattern matching compatibility</a> issues being solve in that proposal.</p>

<p>For additions, I added version-specific <code>Connection</code> types for the client, to replace the &ldquo;either-version&rdquo; type already there. We also put our <a href="https://github.com/hyperium/hyper/blob/master/docs/GOVERNANCE.md">governance</a> down in writing.</p>

<p>You can follow along (and join us!) on this <a href="https://github.com/orgs/hyperium/projects/1/views/6">dashboard</a>. The goal is to have a release candidate out in September!</p>

<h3>HTTP/3</h3>

<p>@eagr got a <a href="https://hyper.rs/h3/ci/compliance/report.html">spec compliance report rendered</a>, using s2n-quic&rsquo;s <a href="https://crates.io/crates/duvet"><code>cargo duvet</code></a>. This lets us track via comments in the code how much of the HTTP/3 spec we are obeying. We still need to fill in a bunch of comments, but there&rsquo;s some in there already!</p>

<p>I created a <a href="https://github.com/seanmonstar/tower-h3">tower-h3</a> repository to experiment with a standalone <code>h3</code> client and server that can use Tower middleware. @kckeiks wrote up a magnificient PR to <a href="https://github.com/seanmonstar/reqwest/pull/1599">add experiemental HTTP/3 support to reqwest</a>. The blocker to merging is figuring out the best way to publish &ldquo;experimental&rdquo; support to crates.io.</p>

<h3>Tower</h3>

<p>We&rsquo;ve heard from many sources that doing retries correctly is hard. Tower has had a <code>retry</code> middleware, but it clearly wasn&rsquo;t doing enough to get proper retries into people&rsquo;s applications. So, @LucioFranco <a href="https://github.com/tower-rs/tower/issues/682">wrote up an issue</a> outlining the ways we&rsquo;ll make it better. This includes some middleware changes to clarify concepts, and additional utilities so that designing custom retry policies is easy, and pushes the user towards safe defaults.</p>

<p>So far, Lucio has improved the <code>Policy</code> trait, derived a simple <code>rng</code> utility, and added a <code>backoff</code> module with trait and a good default based on exponential backoff.</p>
